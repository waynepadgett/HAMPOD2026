ICOM Reader Implementation Specification

Document Purpose: This is a developer-focused rewrite of ICOMReader_Manual_v106.txt combined with clarifications from ICOMReader_Manual_Add_On.txt. It eliminates ambiguity and provides precise behavior specifications for implementation.


Table of Contents

1. System Architecture
2. Mode System
3. Key Input System
4. Normal Mode
5. Frequency Entry Mode
6. Set Mode
7. Memory Mode
8. DStar Mode
9. DTMF Mode
10. Configuration Mode
11. Audio Feedback System
12. Configuration Parameters
13. Error Handling
14. Special Frequencies


Section 1. System Architecture

1.1 Hardware Interface

Serial Ports: 2 male DB9 connectors, port 1 is nearest the power jack.
Baud Rate: 19,200 bps using ICOM CI-V protocol.
Power: 9-15V DC, center-positive, 2.1mm by 5.5mm jack.
Keypad: 16 buttons in a 4 by 4 matrix.
Audio Output: 3.5mm mono headphone jack on some models.

1.2 Keypad Layout

The keypad is a standard 4 by 4 telephone-style matrix. Row 1 from left to right contains keys 1, 2, 3, and A. Row 2 contains keys 4, 5, 6, and B. Row 3 contains keys 7, 8, 9, and C. Row 4 contains keys star, 0, pound, and D.

1.3 Radio Communication

Polling: The HamPod polls for a connected ICOM radio at approximately 1 second intervals.
Connection: On detection, the unit announces the ICOM ID number.
Protocol: All frequency commands use Hamlib, which uses CI-V under the hood.


Section 2. Mode System

2.1 Mode Hierarchy

The system starts in Normal Mode. From Normal Mode, you can enter the following modes:

Press pound to enter Frequency Entry Mode.
Press B to enter Set Mode.
Press Shift plus C to enter Memory Mode.
Press Shift plus D to enter DStar Mode.
Hold Shift plus D to enter DTMF Mode.
Hold C for 1 second to enter Configuration Mode.

To exit each mode and return to Normal Mode:

From Frequency Entry: press pound to submit, or press D, or press star twice, or wait for timeout.
From Set Mode: press pound to submit, or press D or star to cancel.
From Memory Mode: press star or D.
From DStar Mode: press D.
From DTMF Mode: hold D.
From Configuration Mode: hold C to save and exit, or hold D to discard and exit, or wait for timeout.

2.2 Mode List

Normal Mode is the default mode for querying radio parameters.

Frequency Entry Mode allows direct frequency input.

Set Mode allows modification of radio parameters.

Memory Mode allows viewing, transferring, and clearing memory channels.

DStar Mode handles DStar callsign and text entry.

DTMF Mode generates DTMF tones.

Configuration Mode adjusts HamPod settings.


Section 3. Key Input System

3.1 Key Press Types

Short Press: Key is released before 500 milliseconds. This performs the standard action.

Long Press or Hold: Key is held for 500 milliseconds or longer. This performs an alternate action.

3.2 Shift Mechanism

The A key acts as a SHIFT modifier in Normal Mode. Press A and the unit announces "Shift". Then press the next key to execute the shifted action. SHIFT automatically deactivates after the action.

Note: Keys are never pressed simultaneously. All input is sequential.

3.3 Audio Feedback on Key Press

When a key is initially pressed and beep is enabled, you hear a short beep.
When a key is held for 500 milliseconds or longer, you hear a second lower-pitch beep.
When you press an invalid key in the current mode, you hear a low-frequency error beep.

3.4 Keypad Timeout

If timeout is disabled, the system waits indefinitely.
If timeout is set to 5 through 30 seconds, the timer resets on each keypress. When it expires, the system says "timeout" and returns to Normal Mode.

The timeout applies during Frequency Entry Mode, Configuration Mode, and the VFO selection phase after pressing pound.


Section 4. Normal Mode

4.1 Key Mapping Overview

Each key can have up to 6 actions: short press, long press or hold, Shift plus short press, Shift plus long press, Set plus short press, and Set plus Shift plus combinations.

4.2 Complete Key Reference

Key 1, VFO Selection:
Press 1 to select VFO A and announce frequency.
Hold 1 to select VFO B and announce frequency.
Set plus 1 selects Main receiver on IC-7800, 7851, 9100, and 9700.
Set plus Hold 1 selects Sub receiver on those same models.
Shift plus 1 reports VOX status, Gain, and Anti-Gain levels.
Set plus Shift plus 1 sets VOX parameters.
Shift plus Hold 1 reports Break-in status and Delay level.

Key 2, Frequency and Tuning:
Press 2 to announce current working VFO frequency.
Hold 2 to toggle Memory Scan On or Off.
Shift plus 2 reports Tuning Step.
Set plus Shift plus 2 sets Tuning Step, range 0 through 12 depending on model.
Shift plus Hold 2 reports RF/Squelch Control setting.
Set plus Shift plus Hold 2 sets RF/Squelch Control: 0 for Auto, 1 for Squelch, 2 for RF plus Squelch.

Key 3, Split and Duplex:
Press 3 to toggle Split Mode On or Off.
Hold 3 to exchange VFO A and VFO B.
Shift plus 3 cycles Duplex direction from minus to plus to disabled and announces offset. On IC-775, 7610, and 7851 this also disables Dual Watch.
Set plus Shift plus 3 sets Duplex Offset frequency in kHz, up to 4 digits.
Shift plus Hold 3 turns on Dual Watch on IC-775, 7610, and 7851.

Key A, Shift and Volume:
Press A to toggle SHIFT on or off.
Hold A for Volume Up.
Shift plus A turns SHIFT off if currently on.
Shift plus Hold A is not assigned.

Key 4, PreAmp and AGC:
Press 4 to report PreAmp status.
Set plus 4 sets PreAmp 1 or 2 status.
Hold 4 reports AGC status as slow, mid, or fast, and level from 0 through 13.
Shift plus 4 reports Attenuation status.
Set plus Shift plus 4 sets Attenuation level.

Key 5, Tones:
Press 5 to report Repeater, CTCSS, and DTCS Tone status and frequency or code.
Set plus 5 sets Repeater Tone.
Set plus Hold 5 sets CTCSS Squelch Tone.
Set plus Shift plus 5 sets DTCS: A for On, B for Off, C for Polarity.
Shift plus Hold 5 reports Digital Voice Squelch status and code.
Set plus Shift plus Hold 5 sets Digital Voice Squelch.

Key 6, Filters:
Press 6 to report selected Filter Width.
Hold 6 reports Audio Peak Filter.
Shift plus 6 reports Filter Number.
Set plus Shift plus 6 sets Filter Number.
Shift plus Hold 6 reports Roofing Filter.

Key B, Band and Set Mode:
Press B to enter Set Mode. On radios with band stacking, this cycles through Set, Band, and Off.
Hold B for Volume Down.
Shift plus B activates Debug Mode which speaks CI-V data.

Key 7, Noise Blanker and Tuner:
Press 7 to report Noise Blanker status and Level.
Set plus 7 sets Noise Blanker status and Level.
Hold 7 reports Antenna Tuner status as Off, On, or Tuning.
Shift plus 7 reports Antenna Selection.
Shift plus Hold 7 reports Voltage and Current on firmware version 2.xx only.

Key 8, Noise Reduction and Mic:
Press 8 to report Noise Reduction status and Level.
Set plus 8 sets Noise Reduction status and Level.
Hold 8 reports Mic Gain Level.
Set plus Hold 8 sets Mic Gain Level.
Shift plus 8 reports Keyer Speed.
Set plus Shift plus 8 sets Keyer Speed.

Key 9, Notch, Power, and Compression:
Press 9 to report Auto Notch status, Manual Notch status, and Frequency.
Hold 9 reports Power Level.
Set plus Hold 9 sets Power Level.
Shift plus 9 reports Compression status and Level.
Set plus Shift plus 9 sets Compression Level.
Shift plus Hold 9 reports Monitor status and Level.
Set plus Shift plus Hold 9 sets Monitor Level.

Key C, Frequency Announcement and Config:
Press C to toggle Frequency Announcement Delay on or off.
Hold C for 1 second to enter Configuration Mode.
Shift plus C enters Memory Mode.
Shift plus Hold C enters Memory Mode 2 with auto-transfer to VFO.

Key star, Meters:
Press star to report S-Meter.
Hold star to report RF Power Meter.
Shift plus star reports Compression Meter.
Shift plus Hold star reports ALC Meter.

Key 0, Mode and SWR:
Press 0 to report current operating Mode.
Set plus 0 sets current Mode.
Hold 0 toggles Data Mode On or Off.
Shift plus 0 starts SWR query, stays in TX until a key is pressed.
Shift plus Hold 0 takes an SWR reading at 15 percent power with tuner bypassed.

Key pound, Frequency Entry:
Press pound to enter Frequency Entry Mode. Additional presses cycle VFO selection through A, B, Current, and back to A.
Hold pound queries current Time on select models only.
Set plus Hold pound sets current Time using 4 digits in 24-hour format.
Shift plus pound recalls last entered frequency.
Shift plus Hold pound saves current frequency to recall buffer.

Key D, Verbosity and Ports:
Press D to toggle Verbosity on or off.
Hold D to switch between serial ports 1 and 2.
Shift plus D enters DStar Mode.
Set plus Shift plus D sets Dial or Panel Lock.
Shift plus Hold D enters DTMF Mode.


Section 5. Frequency Entry Mode

5.1 Mode Overview

Frequency Entry Mode provides direct numeric input for VFO frequencies. All frequencies are entered in MHz.

5.2 Entry Sequence

Press pound to enter the mode. The unit announces "A" or the last used VFO.
Optionally, press pound again to cycle through VFO B, Current, and back to A.
Enter digits 0 through 9. Each digit is spoken as you press it.
Press star for a decimal point. The unit says "point".
Press pound again to submit the frequency to the radio. The unit speaks the confirmed frequency.

5.3 Key Behaviors in Frequency Entry Mode

Keys 0 through 9 append a digit to the buffer and speak the digit.
Star on first press inserts a decimal point and says "point".
Star on second press clears the entry, says "clear", and exits to Normal Mode.
Pound submits the frequency to the radio and speaks the resulting frequency.
D clears the entry, says "clear", and exits to Normal Mode.
Keys A, B, and C produce a low-frequency error beep and are ignored.
Hold actions are disabled in this mode and are treated as short presses.

5.4 Input Buffer Specification

Maximum buffer size is 11 characters.
If you try to enter a 12th digit, you hear an error beep and the digit is rejected.
An example maximum entry is 1234.123456.
Leading zeros are accepted but ignored in the value.

5.5 Frequency Format Rules

Enter 14.250 for 14.250 MHz in standard format.
Enter 14 followed by a decimal point for 14.000 MHz, trailing zeros are assumed.
Enter a decimal point followed by 250 for 0.250 MHz, which equals 250 kHz. Use a leading dot for kHz entry.
Enter 14 with no decimal for 14 whole MHz.
Entering 0 alone is invalid. It fills the buffer with zeros but no command is sent.
Pressing pound with an empty buffer cycles VFO selection instead.

5.6 Frequency Announcement Format

When announcing a frequency, trailing zeros after the 1 kHz position are not spoken.
If a second decimal point is present, it is spoken as "dot" instead of "point".
For example, 7.240000 is announced as "seven point two four zero".

5.7 Exit Conditions

Successful submission via pound causes the unit to speak the confirmed frequency from the radio.
Cancel via D causes the unit to say "clear".
Cancel via star star causes the unit to say "clear".
Keypad timeout causes the unit to say "timeout".
Invalid entry of just 0 exits silently without sending.


Section 6. Set Mode

6.1 Mode Overview

Set Mode allows modification of radio parameters. It is not a separate mode but rather a modifier flag that changes how Normal Mode keys behave, specifically enabling write operations instead of just read.

6.2 Entry and Exit

Press B from Normal Mode to cycle through: Set, Band, and Off on radios with band stacking, or just Set and Off on other radios.
Press pound to submit the current setting and exit Set Mode.
Press D or star to cancel and exit Set Mode.

Note: The star key can safely exit Set Mode because no Set Mode parameters require decimal input. Parameters that appear to need decimals, such as CTCSS tones like 88.5 Hz, are entered as 3 or 4 digit integers without a decimal point. For example, enter 885 for 88.5 Hz or 1000 for 100.0 Hz.

6.3 Common Control Keys in Set Mode

A toggles On, increments, or selects the next option.
B toggles Off, decrements, or selects the previous option.
C cycles through sub-options, for example VOX Gain versus Anti-Gain.
Keys 0 through 9 enter a numeric value.
Pound confirms and sends to the radio.

6.4 Settable Parameters

PreAmp via Set plus 4:
Press 1 to enable PreAmp 1 and disable PreAmp 2.
Press 2 to enable PreAmp 2 and disable PreAmp 1.
Press 0 to disable all PreAmps.
Stays in Set Mode. Press pound or D to exit.

Attenuation via Set plus Shift plus 4:
Enter 0 through 45 dB depending on model.
Press pound to submit and exit.

Filter Width via Set plus 6:
Hold 1 for Sharp DSP filter shape.
Hold 2 for Soft DSP filter shape.
Press 0 through 9 to enter filter width value, range 0 through 57 or more depending on model.
Press pound to submit.

AGC via Set plus Hold 4:
Hold 1 for Fast AGC.
Hold 2 for Mid AGC.
Hold 3 for Slow AGC.
Press 0 through 9 to enter level from 0 through 13.
Press pound to submit and exit.

Notch Filter via Set plus 7:
Press A to enable Auto or Manual Notch, selected by C.
Press B to disable Auto or Manual Notch.
Press C to toggle between Auto and Manual Notch.
Hold 1 for Wide manual notch width.
Hold 2 for Mid manual notch width.
Hold 3 for Narrow manual notch width.
Press 0 through 9 to set notch frequency from 0 through 100.
Press pound to submit and exit.

VOX via Set plus Shift plus 1:
Press A to enable VOX.
Press B to disable VOX.
Press C to cycle between Gain, Anti-Gain, and Delay.
Press 0 through 9 to enter value for selected control.
Press pound to send.

Other settable parameters include Tuning Step, RF/Squelch Control, Duplex Offset, and Dial/Panel Lock.

6.5 Quick Band Change

For models with Band Stacking Registers:

Press B until "Band" is announced.
Then press a number for immediate band change:
1 for 160 meters, 2 for 80 meters, 3 for 60 meters, 4 for 40 meters, 5 for 20 meters,
6 for 17 meters, 7 for 15 meters, 8 for 12 meters, 9 for 10 meters, 0 for 6 meters,
C for UHF, and D for 1.2G on IC-7100 and 9100 only.


Section 7. Memory Mode

7.1 Mode Overview

Memory Mode allows viewing, transferring, saving, and clearing memory channels. The radio itself does not change mode. It stays in VFO mode unless a clear operation is performed.

7.2 Entry and Exit

Press Shift plus C to enter Memory Mode in review mode.
Hold Shift plus C to enter Memory Mode 2 with auto-transfer to VFO.
Press star or D to exit to Normal Mode if no data is pending.

7.3 Key Behaviors

A increments the channel and announces data.
B decrements the channel and announces data.
Keys 0 through 9 enter a channel number, up to 3 digits.
Pound after entering a channel number goes to that channel. Pound after selecting a VFO transfers and exits.
Hold 0 through 5 selects Memory Bank 0 through 5, depending on model.
C cycles transfer destination through VFO A, VFO B, and Modify Name.
Hold C immediately saves current VFO to selected channel.
Star clears pending input, or exits if nothing is pending.
Hold star immediately clears the selected memory channel.

7.4 Channel Announcement Format

When a channel is accessed, you hear: channel number, alpha-numeric label if populated, RX frequency, and operating mode letter if Frequency Plus Mode is enabled.

7.5 Memory Operations

To transfer memory to VFO: Navigate to the desired channel using A, B, or direct entry. Press C to select target VFO, either A or B. Press pound to transfer and exit.

To save VFO to memory: Navigate to the desired channel location. Hold C for immediate save with no confirmation. This exits to Normal Mode.

To clear a memory channel: Navigate to the channel to clear. Hold star for immediate clear with no confirmation. The radio switches to VFO Mode even if it was in Memory Mode. This exits to Normal Mode.

7.6 Memory Channel Name Tags

To assign a name to a memory channel using the DStar Text Buffer:
Enter DStar Mode with Shift plus D.
Enter text starting with lowercase m followed by the desired name.
Exit DStar Mode with D.
Enter Memory Mode and select the target channel.
Press C until "Modify Name" is announced.
Press pound to write.


Section 8. DStar Mode

8.1 Mode Overview

DStar Mode provides text entry and management for DStar callsigns and parameters. It uses an editable text buffer.

8.2 DStar Fields

My Callsign is 12 characters: your callsign in 8 characters plus a short note in 4 characters.
TX Callsign is 24 characters: UR Callsign in 8 characters, plus RPT1 in 8 characters, plus RPT2 in 8 characters.
TX Message is 20 characters of free-form text.

8.3 Key Mapping

Keys 0 through 9 select a character to write using multi-tap style.
A writes the selected character to the buffer at the cursor and advances the cursor.
B moves the cursor back one position.
Hold B converts the current character to lowercase.
C selects the DStar field: My Callsign, TX Callsign, or TX Message.
Hold C copies field data into the editable buffer.
Pound reads the selected field from the radio.
Hold pound writes the buffer to the selected field in the radio.
Star writes null, meaning end-of-string, at the cursor.
Hold star clears the entire buffer.
Hold 1 reads the buffer contents aloud.
Hold 2 reads the buffer letter-by-letter.
D exits DStar Mode.

8.4 DStar Hot Keys

Hold 4 for Link: sets the 8th character to L and sends TX Callsign.
Hold 5 for Talk: sets the first 8 characters to CQCQCQ with 2 spaces and sends.
Hold 6 for Unlink: sets the first 8 characters to 7 spaces followed by U and sends.
Hold 7 for Relink: restores the saved UR Callsign and sends.
Hold 8 for Echo test: sets the first 8 characters to 7 spaces followed by E and sends.
Hold 9 for Info request: sets the first 8 characters to 7 spaces followed by I and sends.


Section 9. DTMF Mode

9.1 Mode Overview

DTMF Mode converts the keypad into a 16-key DTMF tone generator.

9.2 Entry and Exit

Hold Shift plus D to enter DTMF Mode.
Hold D to exit DTMF Mode.

9.3 Behavior

All 16 keys generate their corresponding DTMF tone.
Key beeps are muted during DTMF Mode.
Tone duration is configurable from 100 to 500 milliseconds, with a default of 200 milliseconds.


Section 10. Configuration Mode

10.1 Entry and Exit

Hold C for 1 second to enter Configuration Mode at the last-viewed option.
Hold C for 1 second again to save changes to EEPROM and exit.
Hold D for 1 second to discard changes and exit. Changes remain until power cycle.
Keypad timeout exits without saving.

10.2 Navigation Keys

A steps forward through options.
B steps backward through options.
C increments the current parameter.
D decrements the current parameter.

All menus are circular and wrap around.

10.3 Invalid Keys

Only A, B, C, and D are valid in Configuration Mode. All other keys produce an error beep and are ignored.


Section 11. Audio Feedback System

11.1 Key Beeps

When a key is pressed with beep enabled, you hear a short beep.
When a key is held for 500 milliseconds or more, you hear a lower-pitch beep to indicate hold.
When you press an invalid key, you hear a low-frequency error beep.

11.2 Status Announcements

Entry cleared: "clear"
Decimal point entered: "point"
Keypad timeout: "timeout"
Radio timeout: "radio timeout"
VFO selection: "A", "B", or "Current"
Set Mode entry: "Set", "Band", or "Off"

11.3 Frequency Announcement Optimizations

The radio returns frequencies with full precision, typically to 10 Hz or 1 Hz. The speech system optimizes announcements as follows:

Trailing zeros after 1 kHz are omitted, but only if all sub-kHz digits are zero.
Non-zero sub-kHz digits trigger a "dot" separator. If any digit below 1 kHz is non-zero, a "dot" is spoken after the 1 kHz digit, followed by the remaining significant digits.
The word "point" is used for the primary decimal at the MHz separator. The word "dot" is used for the secondary separator between kHz and Hz.

Examples:
14.250000 is spoken as "fourteen point two five zero" with all sub-kHz zeros omitted.
7.240000 is spoken as "seven point two four zero" with all sub-kHz zeros omitted.
14.250500 is spoken as "fourteen point two five zero dot five" showing 500 Hz.
7.123456 is spoken as "seven point one two three dot four five six" with full sub-kHz precision.
14.000000 is spoken as "fourteen point zero zero zero" with zeros to 1 kHz spoken.

11.4 Frequency Plus Mode Suffixes

When Frequency Plus Mode is enabled, frequency announcements include a mode suffix:
LSB is "L", USB is "U", CW is "C", CW Reverse is "CR", RTTY is "R", RTTY Reverse is "RR", FM is "F", WFM is "W", AM is "A", AM Sync is "S", PSK is "P", PSK Reverse is "PR", Digital Voice is "DV".


Section 12. Configuration Parameters

12.1 Voice Parameters

Volume: range 0 through 9, default 5.
Speed: range 0 through 13, default 5.
Pitch: range 0 through 99, default 50.
Articulation: range 0 through 9, default 3.
Expression: range 0 through 9, default 3.
Reverb: range 0 through 9, default 0.
Formant Frequency: range 0 through 99, default 50.
Tone: range 0 through 2, default 1.
Voice preset: range 0 through 10, default 0.

12.2 Operational Parameters

Key Beep: on or off.
Key Timeout Duration: off, or 5 through 30 seconds.
Verbosity: on or off.
Frequency Announcement: on or off.
Frequency Announcement Delay: 1.2 through 5.0 seconds in 0.1 second steps.
AF and RF Announcement: on or off.
Frequency Plus Mode: on or off.
Communications Timeout: 5 through 20.
ICOM ID Port 1: 00 through A0 in hex, where A0 means auto-acquire.
ICOM ID Port 2: 00 through A0 in hex, where A0 means auto-acquire.
DTMF Tone Duration: 100 through 500 milliseconds, default 200.
Power On To Port: 1 or 2, default 1.


Section 13. Error Handling

13.1 Error Responses

Invalid key in current mode: low-frequency error beep.
Invalid frequency sent: no acknowledgment, speaks current frequency unchanged.
Radio disconnected: "radio timeout" on next command.
Invalid channel number: error beep, entry cleared.
Communication timeout: "radio timeout".
Invalid parameter value: "failed" response.

13.2 Recovery Behaviors

Frequency entry timeout: returns to Normal Mode.
Radio timeout during command: aborts operation, returns to Normal Mode.
Config mode timeout: exits without saving, settings remain until power cycle.


Section 14. Special Frequencies

14.1 System Commands via Frequency Entry

Enter 777 and press pound to announce the firmware version, for example "HamPod Pi Firmware Version Alpha 0.1".
Enter 999 and press pound for factory reset of EEPROM to defaults and reboot. This is immediate with no confirmation.

14.2 Usage

Enter Frequency Entry Mode by pressing pound.
Select any VFO.
Enter 777 or 999.
Press pound.


Appendix A. Implementation Notes

A.1 State Machine Design

The mode system should be implemented as a finite state machine with clear transitions. The modes are: Normal, Frequency Entry, Set, Memory, DStar, DTMF, and Config.

A.2 Input Buffer Requirements

Frequency Input buffer: maximum 11 characters for digit accumulation.
DStar Text buffer: maximum 24 characters for the largest field, TX Callsign.
Memory Channel buffer: maximum 3 digits for channel number entry.
Generic Value buffer: maximum 2 digits for most Set Mode values.

A.3 Timer Requirements

Key Hold Detection: 500 milliseconds.
Keypad Timeout: 5 through 30 seconds, configurable.
Communications Timeout: 5 through 20 units, configurable.
Frequency Announcement Delay: 1.2 through 5.0 seconds, configurable.

A.4 Key Mapping Priority

When processing a key press:
1. Check current mode.
2. Check if SHIFT is active.
3. Check if SET is active.
4. Check for HOLD condition.
5. Execute corresponding action.
6. Clear SHIFT flag if used.


Revision History

Version 2.0, dated 2025-12-30: Developer-focused rewrite. Incorporated Add-On Q and A clarifications.
Version 1.06, dated 2023-09-06: Original manual.
